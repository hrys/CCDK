# CCDKの概要
CCDKは、"Community Cloud Development Kit" の略で、シンラ・テクノロジーが提供する、クラウドゲームを開発するためのソフトウェア・キットです。

このレポジトリ ( <a href="https://github.com/ShinraTech/CCDK">https://github.com/ShinraTech/CCDK</a> )では、CCDKのドキュメント、ソースコードつきのサンプルゲーム、開発ツールのバイナリアーカイブを配布しています。


CCDKの目的
====
シンラ・テクノロジーがCCDKを通じてクラウドゲーミングの技術を提供する目的は、
ゲーム会社に所属してフルタイムで長時間働かなくても、商用のゲームを作れるようにすることです。

巨額の予算を持たない。自分のゲームのためにフルタイムで働けない。
専用の開発マシンがない。高額な開発ツールがない。
テスト専門のチームや、ITサポートチームを持たない。
CCDKは、そんな状況でも商用のゲームを作れるようにするための試みです。

実現したいことリスト
====
たった一人や、2〜3人までのチームでは、
プログラマの時間をどれだけ節約できるか、
どれだけ少ない手間でゲームを開発できるかが鍵になります。

CCDKは、クラウドゲーミングの技術によって、いままでゲーム開発につきまとっていた、
ゲーム内容と関係ない、めんどくさい作業や費用を、可能な限り削減します。

現在のバージョンでは、以下のすべてが実現できているわけではありませんが、
このすべてを実現するために開発を続けています。

<B>1.「安く作れる」</B>

- 私物のPCに無料のソフトを加えれば開発ができます。VisualStudio ExpressやDirecX, Python, VirtualBox, Linuxなど。 
- プロジェクトの審査は必要ですが、シンラのデータセンター実機を無償で使えます。
- ゲームのWindowsバイナリだけつくれば、どんなプラットフォームにもゲームを提供できます。(現時点はWindowsのみ)
 
<B>2.「早くリリースできる」</B>

- DirectXに対応したゲームエンジンなら、技術的には何でも利用可能
- マルチプレイゲームの実装が極度に簡単になる
- LAN内の通信だけしかないので、ネットコードの開発が簡単になる。
- 課金部分の実装が非常に簡単

<B>3: 「安心してリリースできる」</B>

- プログラムとデータを配らずに公開テストができる。
- 利用者にマルウェアを配る心配がない。
- コピーを配らないので、確実にバージョン管理でき、サービスを停止できる。

<B>4: 「簡単にフィードバックを得られる」</B>

- メールにshinra://リンクを付けて送るだけ。受信した人がリンクをクリックしたらすぐプレイ開始ができる。
- シンラパックさえ保存しておけば、過去の動いてるバージョンを確実にいつでも再提供できる。
- ゲームからデバッグログを出力すれば、該当する時刻のプレイ動画をすぐ取り出せる。
- 操作やプレイ動画の自動録画



技術サポート
====
シンラ・テクノロジーの開発チームが、CCDKの技術サポートを行っています。

不明な点やご質問がございましたら、日本語の場合はメールアドレス ```CCDK-jp@shinra.com```　へ、英語の場合は ```CCDK-en@shinra.com``` までメールしてください。

メール以外にも、<a href="https://www.facebook.com/pages/Shinra-Community-CDK/1613401802228319">CCDKのFacebookグループ</a> も用意しています。
困っている問題以外にも、雑談や、こんなことがやりたい、などといった話題でもかまいませんので、書き込んでみてください。

[FAQ](FAQ.ja.md) も用意していますので、質問をする際にはぜひ、参考にしてください。

CCDKでできること・できないこと
====
CCDKでは、以下のことができます。

1. ゲームの制作とテストプレイ
CCDKでは、1:1、1:N、N:Nモデル、の3つの通信モデルを用いたゲームを開発し、ローカルでの描画結果をリモートにビデオストリーム送信して、シンラ・システムの実運用環境を使った場合の画質や操作の遅延を実際に体験してみたり、バックエンドサーバーを用いた通信の動作確認をしたりすることができます。(2015年4月の段階では、1:Nの開発はまだできません)
2. シンラ・システムの実環境に送るためのパッケージファイルを作成し、それが壊れていないことをローカルでテストプレイして確認する


CCDKでは、以下のことができません。
1. 開発以外の目的のためにゲームをパブリッシュ（配信や販売など）すること。特にシンラ・プラットフォームのエンドユーザーを含む不特定多数のお客様に対してゲームをパブリッシュすること。
2. シンラ・システムのリモートレンダラのパラメータチューニングを行うこと
3. シンラ・システムの実環境に実際に送り、リモートからテストプレイし、エンドユーザーが実際に体験する内容を確認すること。
※この機能は2015年4月現在、開発中です。



MCS  (Minimal Cloud Set)
====
MCSはMinimal Cloud Setの略です。

MCSは、シンラ・システムのリモートレンダラの最小のエミュレータです。
CCDKは、MCSをベースとして設計されています。

以下の図では、シンラ・システムのコアシステム(商用サービス用のシステム)と、MCSと、シンラ・システム無しのゲームをそれぞれ比較しています。

<img src="images/without_shinra.png" width=150>


まず上の図は、シンラ・システム無しで、DirectXを用いてゲームサーバーを動作させている状態を示しています。
一般的なDirectXを用いているゲームは、この状態です。
GPU、そして表示ディスプレイも、CPUと同じマシン上に搭載されているものが使われます。
D3D9.dllはここではフェイクされていず、Microsoft社が提供しているものをそのまま利用します。

![CoreSystem](images/coresystem.png)

上の図は、シンラ・システムの商用版システムの構成を示しています。
CPUマシンとGPUマシンは物理的に分離されており、データセンターのLAN内で、10Gbps以上の超高速なネットワークを用いて接続されています。
CPUマシンではGame serverが、GPUマシンではRendererが動作しています。
エンドユーザー(ゲームを遊ぶ人)はClientプログラムを用いてゲームの操作情報(control)をTCPソケットに用いてゲームサーバーに送信します。
D3D9.dllはフェイクされており、描画のための関数を呼び出すと、その呼出がそのままゲームサーバーから高速ネットワーク経由でレンダリングサーバーに対して送られます。
レンダリングサーバーは描画コマンドを受信すると、GPUを使用して描画とエンコーディングを行い、その結果がTCPストリーム経由でクライアントに送り返されます。
これが、シンラ・プラットフォームの特徴である「リモートレンダリング機能」です。

<img src="images/mcs.png" width=400px>

上図はMCSの構成を示します。商用版システムとは異なり、CPUマシンとGPUマシンが物理的に分離されていることはなく、レンダリングコマンドをネットワーク経由で送信することもありません。ただしD3D9.dllはフェイクされており、同じマシン上にあるGPUを利用して直接レンダリングと映像圧縮を行います。クライアントは、商用サービスと同じようにネットワーク(TCP)経由で操作情報を送信し、ビデオ信号を受信します。

MCSではクライアントとゲームサーバーの間にネットワークが存在するため、ネットワークの設定を調節してネットワークの遅さをシミュレートし、ゲームの操作や画面描画が遅れる感覚を検証したり、画質や音質を実際に見てみることができます。(画質については、MCSで見られるのはデフォルトの状態だけです。コアシステムをパラメータチューンしたら画質は変化します。)

CCDKに含まれているMCSは、シンラ・テクノロジーのデータセンターにおいてシンラ・システム向けのゲーム開発を出来る限り商用版に近い環境で行い、検証作業ができるようにするためにデザインされていますが、商用版のDLLでサポートしている関数と完全に同じではありません。そのためCCDKで開発したゲームを商用版システムで動作させたときには、未知の問題が発生する可能性があります。その場合は、シンラ・テクノロジーが技術サポートを行います。


MCSの最新版は、packagesディレクトリに格納されています。
ファイル名は以下のようになっています。
複数のバージョンが格納されていますが、通常は番号がもっとも大きい、最新のものを利用してください。

~~~
packages/ShinraMCS-8304.34.zip
~~~


CCDKにおけるゲーム開発の実際
====
CCDKを使ってゲームを開発するときは、ほとんどの時間を、Direct3DのDLLをフェイクしない、Windowsの標準状態で作業することになります。
そして、例えばリリースの直前など必要なときにMCSを用いてフェイクDLLとの互換性やパフォーマンスの確認を行い、その確認が取れたら実際にシンラ・テクノロジーのデータセンターにあるマシンにデプロイする、という流れになります。

CCDKを使う場合は、ゲームをゼロから作る必要はありません。
すでに開発途中であったり、完成しているゲームであっても、そのゲームプログラムがDirect3Dを利用していれば、CCDKのフェイクDLLを用いて問題なく対応することができます。ただし、フェイクDLLは、Direct3Dのすべての関数のすべての使用方法を完全にサポートしているわけではないので、MCSを用いた検証作業は必要です。


シンラ・システムでのマルチプレイ実装モデル
====
シンラ・システムでは、”1:1”, “1:N”, “N:N” の3つのパターンでゲームを作るように推奨しています。1:1はシングルプレイ専用、1:N, N:Nの2つがマルチプレイゲーム向けです。
CCDKには、これら3つのパターンのスケルトンコードが含まれています。

1:1は、"One to One"または短く "One-One"と呼びます。
ゲームサーバーのプロセスひとつに対して、ビューワーが一つ接続し、プレイヤーが増えたらこの組をそのまま増やしていきます。
DirectXを用いて実装されているシングルプレイゲームならば、ほぼそのまま修正することなく動作させることができます。(次図)
<img src="images/arch_11.png" width=400></img>

N:Nは "Many to Many"または短く "N-N"と呼びます。
1:1と同じですが、ゲームサーバープロセス同士がLAN経由で通信し、マルチプレイを実現します。
プレイヤーが増えた場合は、どのプロセスと通信をするか、何らかの方法でマッチング(組み合わせ決定処理)をする必要があります。(次図)

<img src="images/arch_nn.png" width=400></img>

1:Nは、"One to Many"または短く "One-N"と呼びます。
ひとつのゲームサーバープロセスが、複数のレンダリングターゲットを保持し、それぞれに異なる内容の描画を行います。この描画内容をそれぞれ異なるプレイヤーにストリームすることによって、マルチプレイを実現します。
この方法のメリットは、N:Nのようなネットワーク経由の通信をする部分のプログラムをしなくても、マルチプレイゲームが実装できることです。
1:Nにおいても、N:Nと同様、どのプレイヤー同士が一緒に遊ぶのか、マッチングをする必要があります。
<img src="images/arch_1n.png" width=400></img>


CCDKテストサーバー
====

MCSに含まれるSDS(Shinra Development Station)を用いて、ゲームの実行に含まれるすべてのファイル(バックエンドサーバーを含む)をパッケージ化し、シンラ・テクノロジーが提供するテストサーバーに送信することで、シンラ・テクノロジーが保有する商用サーバーとほぼ同じ環境においてゲームを検証することができます。

テストサーバーを利用する際の手順は以下の通りです。

1. MCSを使わずに、ゲームのプログラムやデータを実装し検証する
2. MCS(のフェイクDLL)を使って、ストリーミングプレイを検証する
3. SDSを使って、ShinraPack(専用フォーマットのzipファイル)を作成する
4. ShinraPackを、CCDKテストサーバーに送信する (2015年4月は、以下については準備中)
5. CCDKテストサーバーで環境を予約する
5. CCDKテストサーバーでゲームをテストする

CCDKのテストサーバーでゲームが検証できれば、その次の段階としては、シンラ・テクノロジー社と必要なパブリッシング契約などを行い、シンラ・テクノロジーの商用サービス用のサーバーにデプロイして、さらなる検証などを行い、エンドユーザー向けのサービスを準備するという流れになります。
シンラ・テクノロジーの商用サービス用のサーバーについては、ゲームの内容や国などによって詳細な調整が必要になるため、CCDKの技術サポート担当者まで、個別にご連絡ください。


CCDKの取得
====
CCDKは、圧縮ファイルではなく、GitHubのgitレポジトリで配布しています。

クローンするためのコマンドラインは

~~~
git clone https://github.com/ShinraTech/CCDK
~~~

です。クローンするだけでなく、自由にForkして活用することもできます。

開発プロジェクトで使う場合は、各リリースに対応するgitのタグを用いてバージョンを固定すると便利です。


CCDKのセットアップ
===
クローンした後のセットアップ手順については、 "CCDKセットアップドキュメント" を参照してください。

※記載されている会社名・商品名は、各社の商標または登録商標です。